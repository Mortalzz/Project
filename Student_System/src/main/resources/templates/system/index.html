<!DOCTYPE html>
<html lang="th">

<head>
	<meta charset="utf-8">
	<title> 学生管理系统</title>
	<meta charset="utf-8">
	<meta content="width=device-width, initial-scale=1.0" name="viewport">
	<meta content="" name="keywords">
	<meta content="" name="description">
	<script src="/js/jquery-3.4.1.min.js"></script>
	<script src="/js/bootstrap.bundle.min.js"></script>
	<link href="/lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">
	<link href="/lib/tempusdominus/css/tempusdominus-bootstrap-4.min.css" rel="stylesheet" />
	<link href="/lib/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet" />
	<link href="/css/bootstrap.min.css" rel="stylesheet">
	<link href="/css/main-style.css" rel="stylesheet">
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<!-- 引入Bootstrap的CSS文件 -->
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
	<style>
		body {
			font-family: Arial, sans-serif;
			margin: 20px;
		}

		/* 打开弹窗的按钮 */
		.open-modal-btn {
			padding: 10px 20px;
			background-color: #4CAF50;
			color: white;
			border: none;
			cursor: pointer;
		}

		/* 弹窗背景 */
		.modal {
			display: none;
			position: fixed;
			z-index: 1;
			left: 0;
			top: 0;
			width: 100%;
			height: 100%;
			overflow: auto;
			background-color: rgb(0, 0, 0);
			background-color: rgba(0, 0, 0, 0.4);
			padding-top: 60px;
		}

		/* 弹窗内容 */
		.modal-content {
			background-color: #fefefe;
			margin: 5% auto;
			padding: 20px;
			border: 1px solid #888;
			width: 80%;
			max-width: 400px;
		}

		/* 关闭按钮 */
		.close {
			color: #aaa;
			float: right;
			font-size: 28px;
			font-weight: bold;
		}

		.close:hover,
		.close:focus {
			color: black;
			text-decoration: none;
			cursor: pointer;
		}

		.form-group {
			margin-bottom: 15px;
		}

		.form-group label {
			display: block;
			margin-bottom: 5px;
		}

		.change-password-form {
			width: 100%;
		}

		#message {
			margin-top: 10px;
		}
	</style>
	<style>
		.main-content {
		/ padding: 20px;
			display: inline-block;
			width: calc(100% - 0px);
			vertical-align: top;
		}

		.page-content {
			display: none;
		}

		.active {
			display: block;
		}

		.aa {
			margin: 5px auto 5px 40px;
		}
		html, body {
			margin: 0;
			padding: 0;
			overflow: hidden;
			width: 100%;
			height: 100%;
		}
	</style>
</head>


<body>
<!-- 弹窗结构 -->
<div id="passwordModal" class="modal">

	<!-- 弹窗内容 -->
	<div class="modal-content">
		<span class="close">&times;</span>
		<div class="change-password-form">
			<h2>修改密码</h2>
			<div class="form-group">
				<label for="currentPassword">当前密码：</label>
				<input type="password" id="currentPassword" required>
			</div>
			<div class="form-group">
				<label for="newPassword">新密码：</label>
				<input type="password" id="newPassword" required>
			</div>
			<div class="form-group">
				<label for="confirmPassword">确认新密码：</label>
				<input type="password" id="confirmPassword" required>
			</div>
			<button id="changePasswordBtn">保存更改</button>
			<div id="message"></div>
		</div>
	</div>

</div>

<div class="container-fluid position-relative bg-white d-flex p-0">

	<!--Sidebar Start-->
	<div class="sidebar pe-4 pb-3">
		<nav class="navbar bg-light navbar-light">
			<a href="#" class="navbar-brand mx-4 mb-3">
				<h3>学生管理系统</h3>
			</a>

			<div class="d-flex align-items-center ms-4 mb-4">
				<div class="position-relative">
					<img class="rounded-circle" src="/imges/user.jpg" alt="" style="width: 40px; height: 40px;">
					<div
							class="bg-success rounded-circle border border-2 border-white position-absolute end-0 bottom-0 p-1">
					</div>
				</div>
				<div class="ms-3">
					<h6 class="mb-0"></h6>
				</div>
			</div>

			<!-- 菜单栏 -->
			<div class="navbar-nav w-100">

				<div class="nav-item dropdown">
					<a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown"><i
							class="fa fa-address-card" aria-hidden="true"></i>用户信息</a>
					<div class="dropdown-menu bg-transparent border-0">
						<div class="aa">
							<a href="#" class="dropdown-item" onclick="showPage('person1')"><i
									class="fa fa-genderless" aria-hidden="true"></i> 个人信息修改</a>
							<a href="#" class="dropdown-item" onclick="showPage('person2')"><i
									class="fa fa-genderless" aria-hidden="true"></i> 个人信息查询</a>
						</div>
					</div>
				</div>

				<div class="nav-item dropdown">
					<a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown"><i
							class="fa fa-address-card" aria-hidden="true"></i>用户信息</a>
					<div class="dropdown-menu bg-transparent border-0">
						<div class="aa">
							<a href="#" class="dropdown-item" onclick="showPage('personm')"><i
									class="fa fa-genderless" aria-hidden="true"></i> 个人信息查询</a>
						</div>
					</div>
				</div>

				<div class="nav-item dropdown">
					<a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown"><i
							class="fa fa-graduation-cap" aria-hidden="true"></i>课程管理</a>
					<div class="dropdown-menu bg-transparent border-0">
						<div class="aa">
							<a href="#" class="dropdown-item" onclick="showPage('classes1')"><i
									class="fa fa-genderless" aria-hidden="true"></i> 选课管理</a>
							<a href="#" class="dropdown-item" onclick="showPage('classes2')"><i
									class="fa fa-genderless" aria-hidden="true"></i> 课程查询</a>
							<a href="#" class="dropdown-item" onclick="showPage('classes3')"><i
									class="fa fa-genderless" aria-hidden="true"></i> 已选课程查询</a>
						</div>
					</div>
				</div>

				<div class="nav-item dropdown">
					<a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown"><i
							class="fa fa-graduation-cap" aria-hidden="true"></i>课程管理</a>
					<div class="dropdown-menu bg-transparent border-0">
						<div class="aa">
							<a href="#" class="dropdown-item" onclick="showPage('classesm1')"><i
									class="fa fa-genderless" aria-hidden="true"></i> 课程增减</a>
							<a href="#" class="dropdown-item" onclick="showPage('classesm2')"><i
									class="fa fa-genderless" aria-hidden="true"></i> 课程查询</a>
						</div>
					</div>
				</div>

				<div class="nav-item dropdown">
					<a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown"><i
							class="fa fa-university" aria-hidden="true"></i>宿舍安排</a>
					<div class="dropdown-menu bg-transparent border-0">
						<div class="aa">
							<a href="#" class="dropdown-item" onclick="showPage('dormitory1')"><i
									class="fa fa-genderless" aria-hidden="true"></i> 申请寝室</a>
						</div>
					</div>
				</div>

				<div class="nav-item dropdown">
					<a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown"><i
							class="fa fa-university" aria-hidden="true"></i>宿舍安排</a>
					<div class="dropdown-menu bg-transparent border-0">
						<div class="aa">
							<a href="#" class="dropdown-item" onclick="showPage('dormitorym1')"><i
									class="fa fa-genderless" aria-hidden="true"></i> 宿舍信息查询</a>
						</div>
					</div>
				</div>

				<div class="nav-item dropdown">
					<a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown"><i
							class="fa fa-plane" aria-hidden="true"></i>请假管理</a>
					<div class="dropdown-menu bg-transparent border-0">
						<div class="aa">
							<a href="#" class="dropdown-item" onclick="showPage('leave1')"><i
									class="fa fa-genderless" aria-hidden="true"></i> 请假申请</a>
							<a href="#" class="dropdown-item" onclick="showPage('leave2')"><i
									class="fa fa-genderless" aria-hidden="true"></i> 请假结果查询</a>
						</div>
					</div>
				</div>

				<div class="nav-item dropdown">
					<a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown"><i
							class="fa fa-plane" aria-hidden="true"></i>请假管理</a>
					<div class="dropdown-menu bg-transparent border-0">
						<div class="aa">
							<a href="#" class="dropdown-item" onclick="showPage('leavem1')"><i
									class="fa fa-genderless" aria-hidden="true"></i> 请假申请处理</a>
						</div>
					</div>
				</div>

				<div class="nav-item dropdown">
					<a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown"><i class="fa fa-envelope" aria-hidden="true"></i>邮件发送</a>
					<div class="dropdown-menu bg-transparent border-0">
						<div class="aa">
							<a href="#" class="dropdown-item" onclick="showPage('send1')"><i
									class="fa fa-genderless" aria-hidden="true"></i> 集体邮件通知</a>
							<a href="#" class="dropdown-item" onclick="showPage('send2')"><i
									class="fa fa-genderless" aria-hidden="true"></i> 信息不完善通知</a>
							<a href="#" class="dropdown-item" onclick="showPage('send3')"><i
									class="fa fa-genderless" aria-hidden="true"></i> 未选课通知</a>
						</div>
					</div>
				</div>

				<div class="nav-item dropdown">
					<a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown"><i
							class="fa fa-server" aria-hidden="true"></i>信息查询</a>
					<div class="dropdown-menu bg-transparent border-0">
						<div class="aa">
							<a href="https://jwc.cqu.edu.cn/xl.htm" target="_blank" class="dropdown-item" onclick="showPage('info1')"><i
									class="fa fa-genderless" aria-hidden="true"></i> 校历</a>
							<a href="https://www.cqu.edu.cn/xqgk/xxjj.htm" target="_blank" class="dropdown-item" onclick="showPage('info2')"><i
									class="fa fa-genderless" aria-hidden="true"></i> 校训</a>
							<a href="https://www.cqu.edu.cn/jyjx/szdw/ysfc.htm" target="_blank" class="dropdown-item" onclick="showPage('info3')"><i
									class="fa fa-genderless" aria-hidden="true"></i> 师资力量</a>
							<a href="https://www.cqu.edu.cn/xysh/cgss/Aq.htm" target="_blank" class="dropdown-item" onclick="showPage('info4')"><i
									class="fa fa-genderless" aria-hidden="true"></i> 教学设施</a>
						</div>
					</div>
				</div>

				<div class="nav-item dropdown">
					<a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown"><i
							class="fa fa-users" aria-hidden="true"></i>在线咨询</a>
					<div class="dropdown-menu bg-transparent border-0">
						<div class="aa">
							<a href="#" class="dropdown-item" onclick="loadIframe()"><i
									class="fa fa-genderless" aria-hidden="true"></i>在线咨询</a>
						</div>
					</div>
				</div>


				<div class="nav-item dropdown">
					<a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown"><i
							class="fa fa-users" aria-hidden="true"></i>在线回复</a>
					<div class="dropdown-menu bg-transparent border-0">
						<div class="aa">
							<a href="#" class="dropdown-item" onclick="loadadminIframe()"><i
									class="fa fa-genderless" aria-hidden="true"></i>在线回复</a>
						</div>
					</div>
				</div>

			</div>
		</nav>
	</div>
	<!-- Sidebar End -->

	<script>
		var userType = localStorage.getItem('role');
		// 定义英文到中文的映射
		var userTypeMap = {
			'student': '学生',
			'admin': '管理员',
		};
		if (userType && userTypeMap[userType]) {
			$('.ms-3 h6.mb-0').text(userTypeMap[userType]);  // 用中文替换
		}
		function toggleMenu() {
			const menus = document.querySelectorAll('.navbar-nav .nav-item');
			if (userType == 'student' ) {
				menus[1].style.display = 'none';
				menus[2].style.display = 'block';
				menus[3].style.display = 'none';
				menus[4].style.display = 'block';
				menus[5].style.display = 'none';
				menus[6].style.display = 'block';
				menus[7].style.display = 'none';
				menus[8].style.display = 'none';
				menus[9].style.display = 'block';
				menus[10].style.display = 'block';
				menus[11].style.display = 'none';
			}
			else if (userType == 'admin' ) {
				menus[0].style.display = 'none';
				menus[1].style.display = 'block';
				menus[2].style.display = 'none';
				menus[3].style.display = 'block';
				menus[4].style.display = 'none';
				menus[5].style.display = 'block';
				menus[6].style.display = 'none';
				menus[7].style.display = 'block';
				menus[8].style.display = 'block';
				menus[9].style.display = 'block';
				menus[10].style.display = 'none';
				menus[12].style.display = 'block';
			}
		}
		window.onload = toggleMenu;
	</script>

	<script>
		function showPage(pageId) {
			var pages = document.querySelectorAll('.page-content');
			pages.forEach(function(page) {
				page.classList.remove('active');
			});
			var pageToShow = document.getElementById(pageId);
			if (pageToShow) {
				pageToShow.classList.add('active');
			}
		}
	</script>




	<div class="content">

		<!-- Navbar Start -->
		<nav class="navbar navbar-expand bg-light navbar-light sticky-top px-4 py-0">
			<a href="index.html" class="navbar-brand d-flex d-lg-none me-4">
				<h2 class="text-primary mb-0"><i class="fa fa-hashtag"></i></h2>
			</a>
			<a href="#" class="sidebar-toggler flex-shrink-0">
				<i class="fa fa-bars"></i>
			</a>
			<form class="d-none d-md-flex ms-4">

			</form>
			<div class="navbar-nav align-items-center ms-auto">

				<!-- 个人中心 -->
				<div class="nav-item dropdown">
					<a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">
						<img class="rounded-circle me-lg-2" src="/imges/user.jpg" alt=""
							 style="width: 40px; height: 40px;">
						<span class="d-none d-lg-inline-flex">您好</span>
					</a>
					<div class="dropdown-menu dropdown-menu-end bg-light border-0 rounded-0 rounded-bottom m-0">
						<a href="#" class="dropdown-item" id="openModalBtn">修改密码</a>
						<a href="http://localhost:8080/index/login" class="dropdown-item" target="_top">退出登录</a>
					</div>
				</div>
			</div>
		</nav>
		<!-- Navbar End -->


		<!-- Table Start -->
		<div class="main-content">
			<!--页面内容开始-->
			<div class="main-content">
				<div id="person1" class="page-content">
					<iframe src="http://localhost:8080/index/set_stu_profile" width="100%" height="1000px"></iframe>
				</div>
				<div id="personm" class="page-content">
					<iframe src="http://localhost:8080/index/stu_alllist" width="100%" height="1000px"></iframe>
				</div>
				<div id="person2" class="page-content">
					<iframe src="http://localhost:8080/index/stu_list" width="100%" height="1000px"></iframe>
				</div>
				<div id="classes1" class="page-content">
					<iframe src="http://localhost:8080/index/select_course" width="100%" height="1000px"></iframe>
				</div>
				<div id="classes2" class="page-content">
					<iframe src="http://localhost:8080/index/course_list" width="100%" height="1000px"></iframe>
				</div>
				<div id="classes3" class="page-content">
					<iframe src="http://localhost:8080/index/selected	" width="100%" height="1000px"></iframe>
				</div>
				<div id="classesm1" class="page-content">
					<iframe src="http://localhost:8080/index/course_add_sub" width="100%" height="1000px"></iframe>
				</div>
				<div id="classesm2" class="page-content">
					<iframe src="http://localhost:8080/index/course_list" width="100%" height="1000px"></iframe>
				</div>
				<div id="dormitory1" class="page-content">
					<iframe src="http://localhost:8080/index/dormit_list" width="100%" height="1000px"></iframe>
				</div>
				<div id="dormitorym1" class="page-content">
					<iframe src="http://localhost:8080/index/admin_dormitlist" width="100%" height="1000px"></iframe>
				</div>
				<div id="leave1" class="page-content">
					<iframe src="http://localhost:8080/index/req_leave" width="100%" height="1000px"></iframe>
				</div>
				<div id="leave2" class="page-content">
					<iframe src="http://localhost:8080/index/lea_req_slt" width="100%" height="1000px"></iframe>
				</div>
				<div id="leavem1" class="page-content">
					<iframe src="http://localhost:8080/index/admin_leave" width="100%" height="1000px"></iframe>
				</div>
				<div id="send1" class="page-content">
					<iframe src="http://localhost:8080/index/email_collective" width="100%" height="1000px"></iframe>
				</div>
				<div id="send2" class="page-content">
					<iframe src="http://localhost:8080/index/email_loseinfo" width="100%" height="1000px"></iframe>
				</div>
				<div id="send3" class="page-content">
					<iframe src="http://localhost:8080/index/email_lose_course" width="100%" height="1000px"></iframe>
				</div>
				<div id="ask_student" class="page-content">
					<iframe id="studentIframe" src="" width="100%" height="1000px" style="border: none;"></iframe>
				</div>
				<div id="ask_admin" class="page-content">
					<iframe id="adminIframe" src="" width="100%" height="1000px" style="border: none;"></iframe>
				</div>
				<div id="info1" class="page-content">
					<p>111</p>
				</div>
				<div id="info2" class="page-content">
					<p>112</p>
				</div>
				<div id="info3" class="page-content">
					<p>113</p>
				</div>
				<div id="info4" class="page-content">
					<p>114</p>
				</div>
			</div>
			<!--页面内容结束-->
		</div>
	</div>
</div>
<script>
	function loadIframe() {
		document.getElementById('studentIframe').src = 'http://localhost:8080/web/toWebSocketDemo/student';
		document.getElementById('ask_student').style.display = 'block'; // Ensure the iframe container is visible
	}

	function loadadminIframe() {
		document.getElementById('adminIframe').src = 'http://localhost:8080/web/toWebSocketDemo/admin';
		document.getElementById('ask_admin').style.display = 'block'; // Ensure the iframe container is visible
	}

</script>
<script>
	$(document).ready(function () {
		// 获取弹窗元素
		var modal = $('#passwordModal');

		// 获取打开弹窗的按钮
		var btn = $('#openModalBtn');

		// 获取关闭弹窗的 <span> 元素
		var span = $('.close');

		// 当用户点击按钮时，打开弹窗
		btn.on('click', function () {
			modal.show();
		});

		// 当用户点击 <span> (x) 时，关闭弹窗
		span.on('click', function () {
			modal.hide();
		});

		// 当用户点击弹窗外的区域时，关闭弹窗
		$(window).on('click', function (event) {
			if (event.target.id === 'passwordModal') {
				modal.hide();
			}
		});

		// 处理密码修改
		$('#changePasswordBtn').click(function () {
			var currentPassword = $('#currentPassword').val();
			var newPassword = $('#newPassword').val();
			var confirmPassword = $('#confirmPassword').val();

			// 确认新密码和确认密码是否匹配
			if (newPassword !== confirmPassword) {
				$('#message').text("新密码和确认密码不匹配！").css("color", "red");
				return;
			}

			var data = {
				currentPassword: currentPassword,
				newPassword: newPassword
			};

			// 发送 AJAX 请求来修改密码
			$.ajax({
				url: 'http://localhost:8080/student/change_password', // 替换为实际的 API 地址
				method: 'POST',
				data: data,
				dataType: "json",
				success: function (response) {
					if (response.code === 200) {
						$('#message').text("密码修改成功！").css("color", "green");
						$('#currentPassword').val('');
						$('#newPassword').val('');
						$('#confirmPassword').val('');
						setTimeout(function() {
							modal.hide();
							window.location.href = 'http://localhost:8080/index/login'; // 跳转到登录页面
						}, 2000);
					} else {
						$('#message').text("错误: " + response.message).css("color", "red");
					}
				},
				error: function (xhr, status, error) {
					console.error('AJAX Error:', status, error);
					$('#message').text("请求失败，请稍后再试。").css("color", "red");
				}
			});
		});
	});
</script>
<script src="/js/main.js"></script>
</body>
</html>